<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8" />
    <title>camera move</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://unpkg.com/maplibre-gl@2.1.1/dist/maplibre-gl.js"></script>

    <link href="https://unpkg.com/maplibre-gl@2.1.1/dist/maplibre-gl.css" rel="stylesheet" />

    <style>
      body { margin: 0; padding: 0; }
      #map { position: absolute; top: 0; bottom: 0; width: 100%; background: linear-gradient(0deg, #ffffff 0%, #FF853F 55%, #ffffff 65%, #7296c4ff 100%);}
    </style>

  </head>
  <body>
      
    <div id="map"></div>
    <div id="tutoDiv" class="maplibregl-ctrl-top-left mapboxgl-ctrl-top-left" style="height: 60px;width: 450px; margin: 50px;padding:10px ;background-color: #00000077; ">
      <h2 id="tutoH1" style="color: beige;">
        -Press 'C' to change the view mode.
      </h2>
    </div>

    <script>

    var yy ={
    "features": [
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Bird Exhibit",
          "height": 0,
          "base_height": 0,
          "color": "orange"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.618312,
                41.866282
              ],
              [
                -87.61832,
                41.866674
              ],
              [
                -87.618087,
                41.866676
              ],
              [
                -87.618087,
                41.866661
              ],
              [
                -87.617423,
                41.86667
              ],
              [
                -87.617416,
                41.8663
              ],
              [
                -87.618312,
                41.866282
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "06e8fa0b3f851e3ae0e1da5fc17e111e"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Bird Exhibit",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617808,
                41.866266
              ],
              [
                -87.617806,
                41.866293
              ],
              [
                -87.617415,
                41.866298
              ],
              [
                -87.617424,
                41.866671
              ],
              [
                -87.617382,
                41.866669
              ],
              [
                -87.617371,
                41.866274
              ],
              [
                -87.617808,
                41.866266
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "08a10ab2bf15c4d14669b588062f7f08"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "East Hallway",
          "base_height": 0,
          "height": 0,
          "color": "indigo"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616704,
                41.866141
              ],
              [
                -87.616707,
                41.866338
              ],
              [
                -87.61572,
                41.866355
              ],
              [
                -87.61572,
                41.866148
              ],
              [
                -87.616704,
                41.866141
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "09ead44537d94ece576c7bc001c33e53"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "East Entrance",
          "base_height": 0,
          "height": 0,
          "color": "violet"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.61544,
                41.866149
              ],
              [
                -87.615449,
                41.866358
              ],
              [
                -87.615721,
                41.866355
              ],
              [
                -87.61572,
                41.866143
              ],
              [
                -87.61544,
                41.866149
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "12251ebf764b36cf3b8c5ad42e2deb29"
      },
      {
        "type": "Feature",
        "properties": {
          "height": 0,
          "base_height": 0,
          "level": 1,
          "name": "Under the Earth",
          "color": "red"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616701,
                41.865816
              ],
              [
                -87.616705,
                41.866115
              ],
              [
                -87.615712,
                41.866125
              ],
              [
                -87.615706,
                41.865802
              ],
              [
                -87.615936,
                41.865801
              ],
              [
                -87.615938,
                41.865824
              ],
              [
                -87.616701,
                41.865816
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "1ce4f8c186a40b9927006644e27bfd69"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Atrium",
          "base_height": 0,
          "height": 0,
          "color": "yellow"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617365,
                41.865799
              ],
              [
                -87.6167,
                41.865815
              ],
              [
                -87.616718,
                41.866672
              ],
              [
                -87.617384,
                41.86667
              ],
              [
                -87.617365,
                41.865799
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "369f5d8865e677120b7576b1de6082eb"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Ancient Egypt",
          "height": 0,
          "base_height": 0,
          "color": "blue"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.61807,
                41.865761
              ],
              [
                -87.618299,
                41.865758
              ],
              [
                -87.618307,
                41.866139
              ],
              [
                -87.617407,
                41.86615
              ],
              [
                -87.617399,
                41.865799
              ],
              [
                -87.61807,
                41.865789
              ],
              [
                -87.61807,
                41.865761
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "3e9f198afe6d7dff01ac81c6eaa511fb"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "West Arch",
          "height": 3,
          "base_height": 2.7,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617424,
                41.86667
              ],
              [
                -87.617384,
                41.86667
              ],
              [
                -87.617365,
                41.865799
              ],
              [
                -87.617405,
                41.865799
              ],
              [
                -87.617424,
                41.86667
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "402706f28b793d27c78d9615fff747f2"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Bird Exhibit",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.618312,
                41.866283
              ],
              [
                -87.61797,
                41.866288
              ],
              [
                -87.617972,
                41.866265
              ],
              [
                -87.618312,
                41.866259
              ],
              [
                -87.618312,
                41.866283
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "43e1e2fc8399dee075ad59764f2a2878"
      },
      {
        "type": "Feature",
        "properties": {
          "name": "Arch",
          "level": 1,
          "color": "grey",
          "base_height": 2.7,
          "height": 3
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617971,
                41.866291
              ],
              [
                -87.617973,
                41.866265
              ],
              [
                -87.617805,
                41.866267
              ],
              [
                -87.617806,
                41.866294
              ],
              [
                -87.617971,
                41.866291
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "4528ad9b9264cbec65bb2e55ac0012c1"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "color": "grey",
          "base_height": 2.7,
          "height": 3,
          "name": "Arch"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617979,
                41.866167
              ],
              [
                -87.617797,
                41.866168
              ],
              [
                -87.617799,
                41.866145
              ],
              [
                -87.617976,
                41.866144
              ],
              [
                -87.617979,
                41.866167
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "4be6817c3b595042c8d971eebd0c4fd3"
      },
      {
        "type": "Feature",
        "properties": {
          "name": "Kids Zone",
          "level": 1,
          "base_height": 0,
          "height": 0,
          "color": "green"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616718,
                41.866675
              ],
              [
                -87.616709,
                41.866371
              ],
              [
                -87.615725,
                41.866381
              ],
              [
                -87.615732,
                41.866711
              ],
              [
                -87.61596,
                41.866711
              ],
              [
                -87.61596,
                41.866688
              ],
              [
                -87.616718,
                41.866675
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "5775eba03674ea1cb3550ffb38321432"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "color": "grey",
          "name": "Arch",
          "height": 3,
          "base_height": 2.7
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616286,
                41.866119
              ],
              [
                -87.616286,
                41.866144
              ],
              [
                -87.616089,
                41.866149
              ],
              [
                -87.616086,
                41.86612
              ],
              [
                -87.616286,
                41.866119
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "598832b1512dc9facc855c5367251531"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Arch",
          "color": "grey",
          "height": 3,
          "base_height": 2.7
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616287,
                41.866343
              ],
              [
                -87.616288,
                41.866374
              ],
              [
                -87.616076,
                41.866378
              ],
              [
                -87.616077,
                41.866347
              ],
              [
                -87.616287,
                41.866343
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "59ed13d4411ff5f88714d9af539788d2"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "color": "grey",
          "name": "center_arch",
          "base_height": 2.7,
          "height": 3
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.61737,
                41.866198
              ],
              [
                -87.617372,
                41.86624
              ],
              [
                -87.616708,
                41.866243
              ],
              [
                -87.616708,
                41.866203
              ],
              [
                -87.61737,
                41.866198
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "67f8952a18dfe21ee0744a3e86bc41d8"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Kids Zone",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.615719,
                41.866354
              ],
              [
                -87.615718,
                41.866381
              ],
              [
                -87.616077,
                41.866378
              ],
              [
                -87.616077,
                41.866347
              ],
              [
                -87.615719,
                41.866354
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "6bb2c92386bcf4678113d6b3e400ae3b"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Under the Earth",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616089,
                41.866149
              ],
              [
                -87.616089,
                41.866119
              ],
              [
                -87.615711,
                41.866124
              ],
              [
                -87.615713,
                41.866147
              ],
              [
                -87.616089,
                41.866149
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "844c87987089df6b9db3923f6a00e4d6"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Under the Earth",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616707,
                41.866115
              ],
              [
                -87.616286,
                41.866119
              ],
              [
                -87.616285,
                41.866144
              ],
              [
                -87.616705,
                41.866141
              ],
              [
                -87.616707,
                41.866115
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "85547a1ecdbd2ca1fdc6324aea3c6b70"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "North Entrance",
          "height": 0,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617386,
                41.86667
              ],
              [
                -87.617388,
                41.866786
              ],
              [
                -87.617228,
                41.866786
              ],
              [
                -87.617226,
                41.866848
              ],
              [
                -87.616867,
                41.866849
              ],
              [
                -87.616868,
                41.866791
              ],
              [
                -87.616718,
                41.866791
              ],
              [
                -87.616718,
                41.866672
              ],
              [
                -87.617386,
                41.86667
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "91ab1ee01729c33568c7b57eb258e699"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Ancient Egypt",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617394,
                41.865799
              ],
              [
                -87.617405,
                41.86615
              ],
              [
                -87.617802,
                41.866147
              ],
              [
                -87.6178,
                41.866167
              ],
              [
                -87.617369,
                41.866172
              ],
              [
                -87.617364,
                41.865799
              ],
              [
                -87.617394,
                41.865799
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "943171d55d207024791e15294def7e8f"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Ancient Egypt",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617976,
                41.866166
              ],
              [
                -87.617976,
                41.866143
              ],
              [
                -87.618309,
                41.866139
              ],
              [
                -87.618309,
                41.866161
              ],
              [
                -87.617976,
                41.866166
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "a37230898905988cab9b72927dc99258"
      },
      {
        "type": "Feature",
        "properties": {
          "name": "West Hallway",
          "level": 1,
          "base_height": 0,
          "height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.618309,
                41.866161
              ],
              [
                -87.618312,
                41.86626
              ],
              [
                -87.61737,
                41.866272
              ],
              [
                -87.61737,
                41.86617
              ],
              [
                -87.618309,
                41.866161
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "c7cc79da8711d746985f23a9b22c1d5e"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "Kids Zone",
          "height": 3,
          "base_height": 0,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616286,
                41.866343
              ],
              [
                -87.616286,
                41.866374
              ],
              [
                -87.61671,
                41.866371
              ],
              [
                -87.616708,
                41.866338
              ],
              [
                -87.616286,
                41.866343
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "cfbf2aee6a73a45c12e7fc7432d6009e"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "South Entrance",
          "height": 0,
          "base_height": 0,
          "color": "teal"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.617359,
                41.865801
              ],
              [
                -87.617355,
                41.865674
              ],
              [
                -87.617221,
                41.865677
              ],
              [
                -87.617219,
                41.86559
              ],
              [
                -87.616824,
                41.865595
              ],
              [
                -87.616826,
                41.86568
              ],
              [
                -87.616695,
                41.865683
              ],
              [
                -87.6167,
                41.865813
              ],
              [
                -87.617359,
                41.865801
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "d71ab89467076ad023161c37f4ff0d5f"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "East Arch",
          "height": 3,
          "base_height": 2.7,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.616688,
                41.866675
              ],
              [
                -87.616716,
                41.866675
              ],
              [
                -87.616699,
                41.865814
              ],
              [
                -87.616665,
                41.865814
              ],
              [
                -87.616688,
                41.866675
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "dd2baec57e4079eb65dcae5be495da62"
      },
      {
        "type": "Feature",
        "properties": {
          "level": 1,
          "name": "outer-walls",
          "base_height": 0,
          "height": 3,
          "color": "grey"
        },
        "geometry": {
          "coordinates": [
            [
              [
                -87.618087,
                41.86666
              ],
              [
                -87.618087,
                41.866674
              ],
              [
                -87.618319,
                41.866674
              ],
              [
                -87.618298,
                41.865757
              ],
              [
                -87.618326,
                41.865756
              ],
              [
                -87.618347,
                41.866693
              ],
              [
                -87.618068,
                41.866696
              ],
              [
                -87.618067,
                41.866675
              ],
              [
                -87.61741,
                41.866684
              ],
              [
                -87.617416,
                41.866802
              ],
              [
                -87.617247,
                41.866803
              ],
              [
                -87.617246,
                41.866866
              ],
              [
                -87.616846,
                41.866868
              ],
              [
                -87.616848,
                41.866807
              ],
              [
                -87.61669,
                41.866811
              ],
              [
                -87.616693,
                41.866693
              ],
              [
                -87.615992,
                41.866701
              ],
              [
                -87.615992,
                41.866729
              ],
              [
                -87.615703,
                41.866733
              ],
              [
                -87.615689,
                41.866377
              ],
              [
                -87.615412,
                41.866382
              ],
              [
                -87.615411,
                41.866122
              ],
              [
                -87.615689,
                41.866119
              ],
              [
                -87.615682,
                41.865781
              ],
              [
                -87.615966,
                41.865779
              ],
              [
                -87.615969,
                41.865798
              ],
              [
                -87.616669,
                41.865794
              ],
              [
                -87.616663,
                41.865662
              ],
              [
                -87.6168,
                41.865661
              ],
              [
                -87.616796,
                41.865571
              ],
              [
                -87.61726,
                41.865559
              ],
              [
                -87.617258,
                41.865654
              ],
              [
                -87.617388,
                41.865652
              ],
              [
                -87.617395,
                41.865778
              ],
              [
                -87.618045,
                41.865773
              ],
              [
                -87.618044,
                41.865742
              ],
              [
                -87.618325,
                41.865739
              ],
              [
                -87.618326,
                41.865758
              ],
              [
                -87.61807,
                41.865761
              ],
              [
                -87.61807,
                41.865789
              ],
              [
                -87.617356,
                41.8658
              ],
              [
                -87.617356,
                41.865672
              ],
              [
                -87.617218,
                41.865677
              ],
              [
                -87.617215,
                41.86559
              ],
              [
                -87.616822,
                41.865595
              ],
              [
                -87.616827,
                41.86568
              ],
              [
                -87.616694,
                41.865681
              ],
              [
                -87.616697,
                41.865813
              ],
              [
                -87.615939,
                41.865824
              ],
              [
                -87.615937,
                41.8658
              ],
              [
                -87.615706,
                41.865802
              ],
              [
                -87.615713,
                41.866143
              ],
              [
                -87.615441,
                41.86615
              ],
              [
                -87.61545,
                41.866357
              ],
              [
                -87.615724,
                41.866353
              ],
              [
                -87.615733,
                41.866712
              ],
              [
                -87.615959,
                41.86671
              ],
              [
                -87.615959,
                41.866688
              ],
              [
                -87.616719,
                41.866672
              ],
              [
                -87.61672,
                41.866791
              ],
              [
                -87.616869,
                41.86679
              ],
              [
                -87.616868,
                41.86685
              ],
              [
                -87.617223,
                41.866847
              ],
              [
                -87.617227,
                41.866786
              ],
              [
                -87.617387,
                41.866785
              ],
              [
                -87.617383,
                41.86667
              ],
              [
                -87.618087,
                41.86666
              ]
            ]
          ],
          "type": "Polygon"
        },
        "id": "ef6512f46485e27963c248bcc945c3db"
      }
    ],
    "type": "FeatureCollection"
  }






  var CameraParam = { // parametres de rotation et de mouvement de la camera

    cameraPremierePersonne : 0, // vue ordinaire ou en 1er personne

    positionRotationX : 0, // position deplacement total
    XmousePositionSaved : 0, // derniere position de la souris en X

    rotationSpeed : 0.009, // rotationSpeed--  => plus rapide (1 plus rapide que 10)
    FirstMouseMoveSkiped : 0, // bloquer le premier mouvement de souris

    x0  :  0, // coordonnees X du centre 
    y0  :  0, // coordonnees y du centre 

    positionRightingRadius  :  0.00016,//20 0.0006 //24 0.00016

    stepSize  :  0.00001, // distance parcourue en un pas

    keyUp : [38,90,87], // avancer
    keyDown : [40,83,83], // reculer
    keyRight  : [39,68,68], // aller a droite
    keyLeft : [37,81,65], // aller a gauche

    keyToChangeViewMode : 67, // touche pour changer de mode de vue

  };

  function initializeFirstPersonCamera(map,coord=['o','o']){

    if(coord[0]=='o' && coord[1]=='o'){
      CameraParam.x0 = map.getCenter().lng;
      CameraParam.y0 = map.getCenter().lat;
    }else {
      CameraParam.x0 = coord[0];
      CameraParam.y0 = coord[1];
    }
    
    CameraParam.positionRotationX = 0;
    CameraParam.XmousePositionSaved = 0;
    CameraParam.FirstMouseMoveSkiped = 0;

    map.setPitch(85);
    map.setZoom(24);

    CameraParam.cameraPremierePersonne = 1;

    rotateCamera(0);

    el=document.getElementById("tutoH1");
    el.innerHTML="-Press 'C' to change the view mode.<br><br>"+
        "-Use arrow keys to move.<br><br>"+
        "-Use left mouse click to rotate the camera.";
    el=document.getElementById("tutoDiv");
    el.style.height="170px"

    return (CameraParam);

  }

  function resetFirstPersonCamera(map){


    CameraParam.x0 = 0;
    CameraParam.y0 = 0;
    CameraParam.positionRotationX = 0;
    CameraParam.XmousePositionSaved = 0;
    CameraParam.FirstMouseMoveSkiped = 0;

    CameraParam.cameraPremierePersonne = 0;

    map.setPitch(20);
    map.setZoom(17);

    el=document.getElementById("tutoH1");
    el.innerHTML="-Press 'C' to change the view mode.";
    el=document.getElementById("tutoDiv");
    el.style.height="60px"

    return (CameraParam);

}



  function rotateCamera(pas) {

    if(CameraParam.cameraPremierePersonne == 1){

      CameraParam.positionRotationX += pas/(CameraParam.rotationSpeed*window.innerHeight);

      map.setCenter([CameraParam.x0+Math.sin(2*Math.PI*(CameraParam.positionRotationX/1000))*CameraParam.positionRightingRadius*1.35, CameraParam.y0+Math.cos(2*Math.PI*(CameraParam.positionRotationX/1000))*CameraParam.positionRightingRadius])
      map.rotateTo((CameraParam.positionRotationX*0.36) % 360, { duration: 0 });

    }
  }
    
  window.addEventListener('mousemove', function(e){  

    if(CameraParam.cameraPremierePersonne == 1){

      if(e.buttons == 1){// 1 => click gauche

        var XpositionMouseDifference = CameraParam.XmousePositionSaved-e.x;

        if(CameraParam.FirstMouseMoveSkiped==1){

          rotateCamera(XpositionMouseDifference)

        }else{

          CameraParam.FirstMouseMoveSkiped=1;

        }

        CameraParam.XmousePositionSaved=e.x;
      
      }else{

        CameraParam.FirstMouseMoveSkiped=0;
      }

      if(e.buttons == 2)rotateCamera(0) // 2=>click droit

    }

  });

  document.addEventListener('keydown', function (e){

    if(CameraParam.cameraPremierePersonne == 1){

      var northAngle = map.getBearing();
      
      if(northAngle<0)northAngle=360+northAngle;

      northAngle = northAngle * (Math.PI/180);
      

        if (e.keyCode == CameraParam.keyUp[0] || e.keyCode == CameraParam.keyUp[1] || e.keyCode == CameraParam.keyUp[2]){

        CameraParam.x0+=CameraParam.stepSize*Math.sin(northAngle);
        CameraParam.y0+=CameraParam.stepSize*Math.cos(northAngle); 

        } else if (e.keyCode == CameraParam.keyDown[0] || e.keyCode == CameraParam.keyDown[1] || e.keyCode == CameraParam.keyDown[2]){

        CameraParam.x0-=CameraParam.stepSize*Math.sin(northAngle);
        CameraParam.y0-=CameraParam.stepSize*Math.cos(northAngle); 

        } else if (e.keyCode == CameraParam.keyRight[0] || e.keyCode == CameraParam.keyRight[1] || e.keyCode == CameraParam.keyRight[2]){

        CameraParam.y0-=CameraParam.stepSize*Math.sin(northAngle);
        CameraParam.x0+=CameraParam.stepSize*Math.cos(northAngle);

        } else if (e.keyCode == CameraParam.keyLeft[0] || e.keyCode == CameraParam.keyLeft[1] || e.keyCode == CameraParam.keyLeft[2]){

        CameraParam.y0+=CameraParam.stepSize*Math.sin(northAngle);
        CameraParam.x0-=CameraParam.stepSize*Math.cos(northAngle);

      }else if(e.keyCode == CameraParam.keyToChangeViewMode){
        resetFirstPersonCamera(map);
      }

      rotateCamera(0);

    }else if(e.keyCode == CameraParam.keyToChangeViewMode){
      initializeFirstPersonCamera(map , [-87.61703501903,41.86622234154]);
    }

  });





    var map = new maplibregl.Map({
    "maxPitch":85,
    container: 'map',
    style: {
    "id": "raster",
    "version": 8,
    "name": "Raster tiles",
    "center": [0, 0],
    "zoom": 0,
    "sources": {
    "raster-tiles": {
    "type": "raster",
    "tiles": [
    "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
    ],
    "tileSize": 256,
    "minzoom": 0,
    "maxzoom": 50,

    }
    },
    "layers": [{
    "id": "background",
    "type": "background",
    "paint": {
    "background-color": "#e0dfdf"
    }
    }, {
    "id": "simple-tiles",
    "type": "raster",
    "source": "raster-tiles"
    }]
    },
    center: [-87.61703501903,41.86622234154],
    zoom: 17,
    pitch: 20,
    bearing: 0,
    antialias: true
    });
    
    map.on('load', function() {

      map.addSource('floorplan', {
        // GeoJSON Data source used in vector tiles, documented at
        // https://gist.github.com/ryanbaumann/a7d970386ce59d11c16278b90dde094d
        'type': 'geojson',
        //'data': 'https://maplibre.org/maplibre-gl-js-docs/assets/indoor-3d-map.geojson'
        'data': yy
      });

      map.addLayer({
        'id': 'room-extrusion',
        'type': 'fill-extrusion',
        'source': 'floorplan',
        'paint': {
          // See the MapLibre Style Specification for details on data expressions.
          // https://maplibre.org/maplibre-gl-js-docs/style-spec/expressions/
          
          // Get the fill-extrusion-color from the source 'color' property.
          'fill-extrusion-color': ['get', 'color'],
          
          // Get fill-extrusion-height from the source 'height' property.
          'fill-extrusion-height': ['get', 'height'],
          
          // Get fill-extrusion-base from the source 'base_height' property.
          'fill-extrusion-base': ['get', 'base_height'],
          
          // Make extrusions slightly opaque for see through indoor walls.
          'fill-extrusion-opacity': 0.5
        }

      });

      //initializeFirstPersonCamera(map);
      //resetFirstPersonCamera(map)

    });



    </script>
  </body>
</html>
